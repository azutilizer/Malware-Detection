var _textData;
var _cur_textID = 0;
var _text_count = 0;
var _textArray = new Array();

const PreviewImg = document.getElementById("transcript");

$(document).ready(function(){

    // init UI
    var isStart = false;
    _textArray.length = 0;
    _cur_textID = 0;

    var textElem = document.getElementById("Add-Text");
    var textSelected = null;
    textElem.onclick = function(e) {
        textSelected = this.value;
        this.value = null;
    }

    textElem.value = null;
    textElem.onchange = function(e) { // will trigger each time
        if (!this.files) return;

        _text_count = this.files.length;
        _textArray.length = 0;
        _cur_textID = 0;
        for(var i=0; i<_text_count; i++) {
            var reader = new FileReader();
            reader.onload = function (e) {
                _textData = e.target.result;
                _textArray.push(_textData);
            };
            reader.readAsDataURL(this.files[i]);
        }
    };

    function handleFileDialog(changed) {
        // boolean parameter if the value has changed (new select) or not (canceled)

    }

    $(".submit-btn").click(function (e) {
        $("#loading").show();

        _textData = _textArray.pop()

        if (_text_count == 0) {
            alert("please select json text file.");
            return;
        }

        var jsonObj = {
            'vt': _textData
        }

        $.ajax({
            url: "/get-malware_predict",
            type: "POST",
            contentType:"application/json; charset=utf-8",
            data: JSON.stringify(jsonObj),
            dataType: "json",
            success: function (response) {
                isStart = true;
                var result = response['message'];

                $(".result").hide();
                ttext = result;
                html='<ul>';
                html += ('<span data-m=' + '>' + ttext + ' </span>');
                html += '</ul>';
                $("#click-text").html(html);
                $("#click-text").show();
                $("#loading").hide();
            },
            error: function (request, response) {
                isStart = false;
                alert("Web server Error. Try again later.");
                return ;
            },
            complete: function(response) {
            }
        });
    });

});


function clickEvent(index) {

}

function play_slice(tm) {

}

